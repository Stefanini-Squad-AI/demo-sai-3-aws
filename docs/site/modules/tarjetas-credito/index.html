<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarjetas de Cr√©dito - User Story Development Guide</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            background: #f5f7fa;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        .section {
            background: white;
            margin: 20px 0;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .card {
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            padding: 15px;
            background: #fafbff;
        }
        pre {
            background: #f6f8fa;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
        }
        .complexity {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .complexity-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
        }
        .simple { background: #d4edda; color: #155724; }
        .medium { background: #fff3cd; color: #856404; }
        .complex { background: #f8d7da; color: #721c24; }
        footer a {
            color: #667eea;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üì¶ Tarjetas de Cr√©dito</h1>
            <p>Gu√≠a para desarrollar historias de usuario centradas en el ciclo de vida de las tarjetas emitidas desde el sistema legacy.</p>
            <p><strong>Prop√≥sito:</strong> Documentar comportamiento, APIs y validaciones cr√≠ticas para que los equipos entreguen nuevas historias sin perder la consistencia del backend simulado.</p>
        </header>

        <section class="section">
            <h2>üìã Visi√≥n General</h2>
            <p><strong>Contexto de negocio:</strong> Este m√≥dulo conecta los controles de cr√©dito del mainframe con el back-office, permitiendo b√∫squedas r√°pidas y actualizaciones seguras de tarjetas.</p>
            <p><strong>Responsabilidades clave:</strong> filtrar tarjetas por cuenta, consultar detalles fiduciarios (CVV, estatus, vigencia) y actualizar nombre, fecha y estado mediante validaciones escritas en MSW.</p>
        </section>

        <section class="section">
            <h2>üéØ Gu√≠a de Historias de Usuario</h2>
            <h3>üìù Templates espec√≠ficos</h3>
            <div class="grid">
                <div class="card">
                    <h4>Dominio: Operaciones</h4>
                    <p><strong>Patr√≥n:</strong> Como agente, quiero buscar tarjetas por cuenta para validar el estatus antes de responder a un cliente.</p>
                    <p><strong>Ejemplo:</strong> Como agente de cola, quiero listar todas las tarjetas activas de la cuenta 12345678901 para confirmar que puedo procesar una solicitud urgente.</p>
                </div>
                <div class="card">
                    <h4>Dominio: Seguridad</h4>
                    <p><strong>Patr√≥n:</strong> Como supervisor, quiero actualizar el estado a Bloqueada para evitar fraudes sobre una tarjeta expirada.</p>
                    <p><strong>Ejemplo:</strong> Como seguridad, quiero modificar el `activeStatus` a `B` tras detectar una alerta del equipo antifraude.</p>
                </div>
            </div>

            <h3>‚ö° Factores de aceleraci√≥n</h3>
            <ul>
                <li><strong>hooks/useCreditCard*</strong>: centralizan las validaciones antes y despu√©s de las llamadas HTTP y permiten reusar l√≥gica entre pantallas.</li>
                <li><strong>MSW (app/mocks)</strong>: ofrece endpoints replicando delays de 400-800ms y permite iterar sin backend real.</li>
                <li><strong>apiClient</strong>: agrega timeout, cabeceras y manejo de `ApiError` en un solo lugar, reduciendo Boilerplate.</li>
            </ul>

            <h3>üìä Gu√≠as de complejidad</h3>
            <div class="complexity">
                <div class="complexity-badge simple">Simple (1-2 pts)</div>
                <div class="complexity-badge medium">Medio (3-5 pts)</div>
                <div class="complexity-badge complex">Complejo (5-8 pts)</div>
            </div>
            <ul>
                <li><strong>Simple (1-2 pts):</strong> Mostrar lista paginada usando `/credit-cards/list` con filtros por `accountId`.</li>
                <li><strong>Medio (3-5 pts):</strong> Validar detalles con `/credit-cards/details` y agregar alertas cuando el CVV no coincide.</li>
                <li><strong>Complejo (5-8 pts):</strong> Crear flujo de validaciones completas antes de enviar `PUT /credit-cards/update` y sincronizar estados con `mockCardUpdateDetails`.</li>
            </ul>
        </section>

        <section class="section">
            <h2>üîß Fundamento T√©cnico</h2>
            <h3>üèóÔ∏è Componentes clave</h3>
            <div class="grid">
                <div class="card">
                    <h4>CreditCardListScreen</h4>
                    <p><strong>Responsabilidad:</strong> Mostrar filtros y tabla con paginaci√≥n manual.</p>
                    <p><strong>Reutilizaci√≥n:</strong> Reusa `useCreditCardList` para validar filtros antes de llamar al API.</p>
                </div>
                <div class="card">
                    <h4>CreditCardUpdateScreen</h4>
                    <p><strong>Responsabilidad:</strong> Formulario con campos obligatorios y botones de prueba.</p>
                    <p><strong>Reutilizaci√≥n:</strong> Comparte validaciones con `creditCardUpdateHandlers`.</p>
                </div>
            </div>

            <h3>üîó Dependencias</h3>
            <ul>
                <li><strong>apiClient:</strong> HTTP shared client con headers CSRF y manejo de `ApiError`.</li>
                <li><strong>MSW:</strong> Handlers en `app/mocks` que replican validaciones COBOL.</li>
            </ul>

            <h3>üåê Interfaces p√∫blicas</h3>
            <pre><code>POST /api/credit-cards/list - Lista paginada con filtros y validaciones de 11/16 d√≠gitos
POST /api/credit-cards/details - Devuelve CVV y estado para accountId/cardNumber
POST /api/credit-cards/search - Recupera datos antes de editar
PUT /api/credit-cards/update - Persiste nombre, estado y vigencia con reglas estrictas
GET /api/credit-cards/update/:cardNumber - Consulta r√°pida del registro actualizado
GET /api/credit-cards/update/test-cards - Devuelve tarjetas de prueba con estatus</code></pre>

            <h3>üìä Modelos de datos</h3>
            <pre><code>export interface CreditCardUpdateResponse {
    accountId: number;
    cardNumber: string;
    cvvCode: number;
    embossedName: string;
    activeStatus: 'A' | 'B' | 'E' | 'I';
    expiryMonth: string;
    expiryYear: string;
    success: boolean;
    errorMessage?: string;
}
</code></pre>
        </section>

        <section class="section">
            <h2>üìã Reglas de Negocio</h2>
            <ul>
                <li><strong>Regla 1:</strong> `accountId` debe ser un n√∫mero de 11 d√≠gitos diferente de cero.</li>
                <li><strong>Regla 2:</strong> Solo se acepta `cardNumber` de 16 d√≠gitos y debe coincidir con la cuenta.</li>
                <li><strong>Regla 3:</strong> `embossedName` solo admite letras y espacios, con un m√°ximo de 50 caracteres.</li>
                <li><strong>Regla 4:</strong> `activeStatus` solo admite A/B/E/I, cualquier otro valor se rechaza.</li>
                <li><strong>Regla 5:</strong> La fecha de expiraci√≥n no puede estar en el pasado y debe caer en el rango actual-2099.</li>
            </ul>
        </section>

        <section class="section">
            <h2>üéØ Patrones de Criterios de Aceptaci√≥n</h2>
            <div class="grid">
                <div class="card">
                    <h4>Autenticaci√≥n</h4>
                    <p>Debe incluir token v√°lido en `Authorization` (extra√≠do de `localStorage` por `apiClient`).</p>
                </div>
                <div class="card">
                    <h4>Validaci√≥n</h4>
                    <p>Los endpoints rechazan input inv√°lido con `errorMessage` detallado desde MSW.</p>
                </div>
                <div class="card">
                    <h4>Performance</h4>
                    <p>Responde dentro de 1200ms, ya que los handlers usan `setTimeout` de 600-800ms.</p>
                </div>
                <div class="card">
                    <h4>Errores</h4>
                    <p>Muestra `errorMessage` desde MSW y evita llamadas repetidas si `errors.length > 0`.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>‚ö° Consideraciones de Rendimiento</h2>
            <ul>
                <li><strong>Tiempo de respuesta:</strong> < 1200ms para operaciones fundamentales.</li>
                <li><strong>Throughput:</strong> 40 req/s estimados en el mock sin bloqueo de red.</li>
                <li><strong>Uso de memoria:</strong> < 80MB por sesi√≥n ya que todo vive en memoria de MSW.</li>
                <li><strong>Estrategia de cache:</strong> `useCreditCard*` retiene filtros recientes y evita recargas si las entradas no cambian.</li>
            </ul>
        </section>

        <section class="section">
            <h2>üö® Riesgos de Desarrollo & Mitigaciones</h2>
            <div class="grid">
                <div class="card">
                    <h4>‚ö†Ô∏è Dependencia de MSW</h4>
                    <p><strong>Riesgo:</strong> Los handlers simulan COBOL, pero el backend real puede cambiar respuestas.</p>
                    <p><strong>Mitigaci√≥n:</strong> Usar `useApi` para detectar respuestas directas del backend y adaptar validaciones.</p>
                </div>
                <div class="card">
                    <h4>‚ö†Ô∏è Validaciones duplicadas</h4>
                    <p><strong>Riesgo:</strong> Reglas repetidas en frontend y handlers pueden diverger.</p>
                    <p><strong>Mitigaci√≥n:</strong> Mantener `mockCardUpdateDetails` y los hooks sincronizados; documentar reglas en este m√≥dulo.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>üìö Ejemplos de C√≥digo</h2>
            <h3>Patr√≥n t√≠pico</h3>
            <pre><code>const response = await apiClient.put('/credit-cards/update', {
  accountId: Number(searchForm.accountId),
  cardNumber: searchForm.cardNumber,
  embossedName: formState.embossedName,
  activeStatus: formState.activeStatus,
  expiryMonth: Number(formState.expiryMonth),
  expiryYear: Number(formState.expiryYear),
  expiryDay: 1,
});
</code></pre>
            <p>El hook `useCreditCardUpdate` env√≠a esta petici√≥n tras validar todos los campos y actualiza el estado local con el resultado.</p>
        </section>

        <footer style="text-align: center; margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
            <p><a href="../index.html">‚Üê Volver al √≠ndice de m√≥dulos</a></p>
            <p><a href="../../index.html">üè† Volver al hub de documentaci√≥n</a></p>
            <p style="color: #666; margin-top: 15px;"><em>√öltima actualizaci√≥n: 2026-01-23 | Precisi√≥n de m√≥dulos: 95%</em></p>
        </footer>
    </div>
</body>
</html>
