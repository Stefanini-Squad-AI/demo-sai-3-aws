<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration Menu - Gu√≠a de Desarrollo de Historias de Usuario</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            background: #f5f7fa;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .section {
            background: white;
            margin: 20px 0;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .section h2 {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .card {
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            background: #f8f9fa;
        }
        .card h4 { color: #667eea; margin-bottom: 10px; }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.9em;
        }
        .complexity {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .complexity-badge {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin: 5px;
        }
        .simple { background: #d4edda; color: #155724; }
        .medium { background: #fff3cd; color: #856404; }
        .complex { background: #f8d7da; color: #721c24; }
        ul {
            padding-left: 20px;
            line-height: 1.8;
        }
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            background: white;
            border-radius: 8px;
        }
        footer a { color: #667eea; text-decoration: none; font-weight: 600; }
        footer a:hover { text-decoration: underline; }
        .badge-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .badge-tag {
            padding: 5px 12px;
            background: #e3f2fd;
            border-radius: 20px;
            font-size: 0.85em;
            color: #1976d2;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üì¶ Administration Menu</h1>
            <p style="font-size: 1.2em; opacity: 0.95;">Gu√≠a de desarrollo en espa√±ol para el m√≥dulo de seguridad y administraci√≥n</p>
            <p style="margin-top: 10px;"><strong>Prop√≥sito:</strong> Gestionar usuarios del sistema (listar, crear, editar, borrar) respetando las teclas r√°pidas heredadas del entorno COBOL.</p>
        </header>

        <section class="section">
            <h2>üìã Overview</h2>
            <p><strong>Contexto de negocio:</strong> Este m√≥dulo es la puerta de entrada de los administradores al back-office. Permite gestionar cuentas de usuarios del sistema, mantener las credenciales, asignar roles `A`/`U` y auditar accesos desde la misma interfaz `CADM` que reemplaz√≥ al COBOL original.</p>
            <p><strong>Responsabilidades principales:</strong></p>
            <ul>
                <li>Exponer el men√∫ de administraci√≥n (`MenuScreen.tsx`) con opciones numeradas para listar, crear, actualizar y eliminar usuarios.</li>
                <li>Listar usuarios con paginaci√≥n, selecci√≥n `U/D` y atajos (`Enter`, `F7`, `F8`) manteniendo sensaci√≥n de mainframe.</li>
                <li>Validar formularios de alta/edici√≥n con contrase√±as de 8 caracteres y tipos `A`/`U` obligatorios.</li>
                <li>Comunicar cada acci√≥n a los endpoints REST (`/api/users/*`) y reutilizar el adaptador `UserApiAdapter` para no repetir l√≥gica.</li>
                <li>Ofrecer mensajes de √©xito/fracaso con `Alert` y `Snackbar` mientras se respeta la navegaci√≥n con `ProtectedRoute requiredRole="admin"`.</li>
            </ul>
        </section>

        <section class="section">
            <h2>üéØ Gu√≠a de Desarrollo de Historias de Usuario</h2>
            <h3>üìù Templates espec√≠ficos</h3>
            <div class="grid">
                <div class="card">
                    <h4>Listar y seleccionar usuario</h4>
                    <p><strong>Patr√≥n:</strong> Como admin, quiero listar usuarios y usar teclas `Enter`, `F7`, `F8` para seleccionar y navegar.</p>
                    <p><strong>Ejemplo:</strong> Como administrador de seguridad, quiero buscar un usuario por `userId`, marcar `U` y presionar Enter para ir al formulario de edici√≥n.</p>
                </div>
                <div class="card">
                    <h4>Crear usuario nuevo</h4>
                    <p><strong>Patr√≥n:</strong> Como admin, quiero un formulario guiado que valide `userId`, `password` y `userType` antes de guardar.</p>
                    <p><strong>Ejemplo:</strong> Como encargado de accesos, quiero crear un usuario con ID de 8 caracteres y contrase√±a segura para autorizar un nuevo operador.</p>
                </div>
                <div class="card">
                    <h4>Eliminar usuario con confirmaci√≥n</h4>
                    <p><strong>Patr√≥n:</strong> Como auditor, quiero cargar el usuario, verificar los datos y presionar F5 para eliminarlo con mensaje de confirmaci√≥n.</p>
                    <p><strong>Ejemplo:</strong> Como auditor de cumplimiento, quiero borrar un usuario inactivo solo despu√©s de ver su nombre completo y recibir el mensaje de eliminaci√≥n.</p>
                </div>
            </div>

            <h3>‚ö° Factores de aceleraci√≥n</h3>
            <ul>
                <li><strong>`useUserList`:</strong> encapsula b√∫squeda paginada, navegaci√≥n F7/F8 y validaci√≥n de selecci√≥n (U/D) para reutilizar la l√≥gica en futuros listados administrativos.</li>
                <li><strong>`UserApiAdapter`:</strong> traduce los contratos del frontend a los endpoints Spring (`/api/users/*`) y permite alternar entre MSW y backend real sin tocar componentes.</li>
                <li><strong>`Material-UI List + Chips`:</strong> los chips numerados y los botones con √≠conos agilizan la replicaci√≥n del men√∫ num√©rico del mainframe.</li>
                <li><strong>`ProtectedRoute requiredRole="admin"`:</strong> asegura que solo personal autorizado accede al men√∫, permitiendo reutilizar la misma l√≥gica en futuras rutas.</li>
                <li><strong>`MSW + VITE_USE_MOCKS`:</strong> aceleran el desarrollo de historias sin depender de un backend real.</li>
            </ul>

            <h3>üìä Gu√≠as de complejidad</h3>
            <div class="complexity">
                <span class="complexity-badge simple">Simple (1-2 pts)</span>
                <span class="complexity-badge medium">Medio (3-5 pts)</span>
                <span class="complexity-badge complex">Complejo (5-8 pts)</span>
            </div>
            <ul>
                <li><strong>Simple:</strong> Agregar un tooltip o badge en la tabla de usuarios que indique el rol (A/U).</li>
                <li><strong>Medio:</strong> Implementar una validaci√≥n adicional (por ejemplo, no permitir repetir nombres exactos) antes de llamar a `POST /api/users`.</li>
                <li><strong>Complejo:</strong> Integrar un servicio externo de auditor√≠a que registre cada `Update/Delete` en un sistema separado y coordinar la UI para mostrar estado.</li>
            </ul>
        </section>

        <section class="section">
            <h2>üîß Fundaci√≥n T√©cnica</h2>
            <h3>üèóÔ∏è Componentes clave</h3>
            <div class="grid">
                <div class="card">
                    <h4>MenuScreen.tsx</h4>
                    <p><strong>Responsabilidad:</strong> Orquestar el men√∫ CADM con `AdminPanelSettings`, chips numerados y teclado F3.</p>
                    <p><strong>Reusabilidad:</strong> Patr√≥n replicable para futuros men√∫s de operaci√≥n con atajos.</p>
                </div>
                <div class="card">
                    <h4>UserListScreen.tsx</h4>
                    <p><strong>Responsabilidad:</strong> Mostrar tabla, b√∫squeda, seleccion y paginaci√≥n con SystemHeader.</p>
                    <p><strong>Reusabilidad:</strong> Funciones `handleEnterKey`, `handlePageChange` reutilizables para otras listas.</p>
                </div>
                <div class="card">
                    <h4>UserAddScreen.tsx</h4>
                    <p><strong>Responsabilidad:</strong> Formulario con validaciones, toggle de visibilidad y `handleFieldChange` centralizado.</p>
                    <p><strong>Reusabilidad:</strong> Renderizado din√°mico de `TextField` y adornos (icons, chips).</p>
                </div>
                <div class="card">
                    <h4>UserUpdateScreen.tsx</h4>
                    <p><strong>Responsabilidad:</strong> Cargar `userId`, detectar cambios (`hasChanges`) y pedir confirmaci√≥n antes de guardar.</p>
                    <p><strong>Reusabilidad:</strong> Patr√≥n `useMutation` + validaci√≥n de cambios para formularios transaccionales.</p>
                </div>
                <div class="card">
                    <h4>UserDeleteScreen.tsx</h4>
                    <p><strong>Responsabilidad:</strong> Verificar que el `userId` existe antes de eliminar y mostrar `messageType`.</p>
                    <p><strong>Reusabilidad:</strong> Flow de confirmaci√≥n √∫til para otras pantallas destructivas.</p>
                </div>
                <div class="card">
                    <h4>Hooks de usuario</h4>
                    <p><strong>Responsabilidad:</strong> `useUserList`, `useUserAdd`, `useUserUpdate`, `useUserDelete` encapsulan l√≥gica de validaci√≥n y navegaci√≥n.</p>
                    <p><strong>Reusabilidad:</strong> Plantilla para cualquier hook que combine `useMutation`, `navigate` y `Alert`.</p>
                </div>
                <div class="card">
                    <h4>UserApiAdapter</h4>
                    <p><strong>Responsabilidad:</strong> Adaptar requests/responses entre frontend y backend real y manejar paginaci√≥n.</p>
                    <p><strong>Reusabilidad:</strong> Modelo de adaptador para otros m√≥dulos (transacciones, tarjetas).</p>
                </div>
            </div>

            <h3>üîó Dependencias</h3>
            <ul>
                <li><strong>React Router DOM:</strong> `ProtectedRoute` dirige a `/menu/admin` y protege las rutas `/admin/users/*`.</li>
                <li><strong>Redux Toolkit + store hooks:</strong> `useAppDispatch` y `logoutUser` para mantener sesi√≥n segura.</li>
                <li><strong>Material-UI 5:</strong> Listas, Tables, Chips, Alerts y SystemHeader para UI consistente.</li>
                <li><strong>MSW + VITE_USE_MOCKS:</strong> Permiten alternar entre mocks y backend real sin modificar componentes.</li>
                <li><strong>Spring Security + JWT:</strong> El backend solo acepta tokens v√°lidos para los endpoints `/api/users/*`.</li>
            </ul>

            <h3>üåê Interfaces p√∫blicas</h3>
            <pre><code>GET  /api/users/list               - Lista paginada (params: searchUserId, pageNumber, direction)
POST /api/users/process-selection   - Procesa selecci√≥n U/D y devuelve redirectUrl
GET  /api/users/previous-page       - P√°gina anterior (F7)
GET  /api/users/next-page           - P√°gina siguiente (F8)
POST /api/users                    - Crear usuario (userId, firstName, lastName, password, userType)
GET  /api/users/{userId}           - Obtener detalle para edici√≥n/eliminaci√≥n
PUT  /api/users/{userId}           - Guardar cambios validados (UserUpdateRequest)
DELETE /api/users/{userId}         - Eliminar usuario con confirmaci√≥n</code></pre>
        </section>

        <section class="section">
            <h2>üìä Modelos de Datos</h2>
            <pre><code>export interface UserSecurityData {
  userId: string;
  firstName: string;
  lastName: string;
  userType: 'A' | 'U' | 'R';
  createdDate?: string;
  lastLoginDate?: string;
  isActive?: boolean;
}

export interface UserUpdateData {
  userId: string;
  firstName: string;
  lastName: string;
  userType: 'A' | 'U';
  password?: string;
  createdDate?: string;
  lastLoginDate?: string;
  isActive?: boolean;
}

export interface UserAddRequest {
  userId: string;
  firstName: string;
  lastName: string;
  password: string;
  userType: string;
}</code></pre>
        </section>

        <section class="section">
            <h2>üìã Reglas de Negocio</h2>
            <ul>
                <li><strong>RN-AM-001:</strong> `userId` siempre en may√∫sculas, 1-8 caracteres y √∫nico.</li>
                <li><strong>RN-AM-002:</strong> `password` obligatorio; creaci√≥n permite ‚â§8 y actualizaci√≥n exige exactamente 8.</li>
                <li><strong>RN-AM-003:</strong> `userType` solo acepta `A` o `U` y se limpia antes del submit.</li>
                <li><strong>RN-AM-004:</strong> F3/Escape regresa al men√∫ (`/menu/admin`), F12 cierra sesi√≥n (`logoutUser`).</li>
                <li><strong>RN-AM-005:</strong> ENTER procesa la primera selecci√≥n `U/D`, F7/F8 controlan paginaci√≥n y F4 limpia formularios.</li>
                <li><strong>RN-AM-006:</strong> Eliminar usuario requiere cargar datos (`GET /api/users/{userId}`) y confirmar antes de ejecutar `DELETE`.</li>
            </ul>
        </section>

        <section class="section">
            <h2>üéØ Acceptance Criteria Patterns</h2>
            <div class="grid">
                <div class="card">
                    <h4>Autenticaci√≥n</h4>
                    <p>Solo usuarios con `role: 'admin'` pueden acceder a `/menu/admin` y a `/admin/users/*` gracias a `ProtectedRoute`.</p>
                </div>
                <div class="card">
                    <h4>Validaci√≥n</h4>
                    <p>Los formularios validan `userId`, `password` y `userType` antes de invocar `useMutation`. Se muestra un Alert en caso de error.</p>
                </div>
                <div class="card">
                    <h4>Performance</h4>
                    <p>`GET /api/users/list` responde en < 400ms, `POST /api/users/process-selection` en < 300ms y la paginaci√≥n es de 10 filas por request.</p>
                </div>
                <div class="card">
                    <h4>Error Handling</h4>
                    <p>Cuando no se encuentra un usuario, el hook muestra mensaje y el bot√≥n de eliminaci√≥n queda deshabilitado hasta que se busque uno v√°lido.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>‚ö° Consideraciones de Rendimiento</h2>
            <ul>
                <li><strong>Lista de usuarios:</strong> `GET /api/users/list` debe responder en menos de 400ms (P95) con paginaci√≥n de 10 filas.</li>
                <li><strong>Procesamiento de selecci√≥n:</strong> `POST /api/users/process-selection` entrega `redirectUrl` en < 300ms y permite navegar con Enter.</li>
                <li><strong>Guardado / Eliminaci√≥n:</strong> `PUT` y `DELETE` no deben superar 500ms y muestran mensaje de confirmaci√≥n antes de recargar la lista.</li>
                <li><strong>Carga inicial:</strong> El men√∫ admin (`/menu/admin`) debe inicializarse en < 1s incluso con MSW activado.</li>
            </ul>
        </section>

        <section class="section">
            <h2>üö® Riesgos de Desarrollo y Mitigaciones</h2>
            <div class="grid">
                <div class="card">
                    <h4>‚ö†Ô∏è Riesgo: Dependencia de `/api/users`</h4>
                    <p><strong>Descripci√≥n:</strong> Cambios en los endpoints o en la estructura del DTO rompen `UserApiAdapter` y los hooks.</p>
                    <p><strong>Mitigaci√≥n:</strong> Versionar el adaptador, mantener MSW sincronizado y documentar `POST /api/users/process-selection` en Swagger.</p>
                </div>
                <div class="card">
                    <h4>‚ö†Ô∏è Riesgo: Flujos de teclado</h4>
                    <p><strong>Descripci√≥n:</strong> Alterar los atajos (F5, F7, F8, Enter) afecta la capacidad operativa de los equipos legacy.</p>
                    <p><strong>Mitigaci√≥n:</strong> A√±adir pruebas de integraci√≥n que simulen los key handlers y actualizar la documentaci√≥n cuando se introduzcan nuevas teclas.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>üìö Ejemplos de C√≥digo</h2>
            <h3>Patr√≥n t√≠pico de selecci√≥n y navegaci√≥n</h3>
            <pre><code>const handleUserAction = useCallback((action: UserSelectionAction) => {
  if (!action.action || (action.action !== 'U' && action.action !== 'D')) {
    options.onError?.('Invalid selection. Valid values are U and D');
    return;
  }

  if (!action.userId.trim()) {
    options.onError?.('User ID cannot be empty');
    return;
  }

  switch (action.action.toUpperCase()) {
    case 'U':
      navigate(`/admin/users/update?userId=${action.userId}`);
      break;
    case 'D':
      navigate(`/admin/users/delete?userId=${action.userId}`);
      break;
  }
}, [navigate, options]);</code></pre>
        </section>

        <footer>
            <p><a href="../../index.html">‚Üê Volver al hub de m√≥dulos</a></p>
            <p><a href="../../index.html">üè† Volver al centro de documentaci√≥n</a></p>
            <p style="color: #666; margin-top: 15px;"><em>√öltima actualizaci√≥n: 2026-02-15 | Precisi√≥n del m√≥dulo: 95%</em></p>
        </footer>
    </div>
</body>
</html>
