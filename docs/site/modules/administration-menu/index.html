<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Men√∫ de Administraci√≥n - Gu√≠a de Historias de Usuario</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            background: #f5f7fa;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header {
            background: linear-gradient(135deg, #1f3b53 0%, #3b8dbd 100%);
            color: white;
            padding: 50px 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        .header::after {
            content: '‚öôÔ∏è';
            position: absolute;
            right: 30px;
            bottom: 20px;
            font-size: 3rem;
            opacity: 0.35;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p.subtitle { opacity: 0.85; margin-top: 15px; }
        .section {
            background: white;
            margin: 20px 0;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .section h2 {
            color: #1f3b53;
            border-bottom: 3px solid #3b8dbd;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .card {
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            background: #f8f9fa;
        }
        .card h4 { color: #1f3b53; margin-bottom: 10px; }
        pre {
            background: #0c0c0e;
            color: #f4f4f4;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.9em;
        }
        .complexity-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin: 5px 5px 0 0;
        }
        .simple { background: #d4edda; color: #155724; }
        .medium { background: #fff3cd; color: #856404; }
        .complex { background: #f8d7da; color: #721c24; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th { background: #1f3b53; color: white; }
        .badge {
            display: inline-block;
            padding: 5px 12px;
            background: rgba(63, 81, 181, 0.1);
            color: #3f51b5;
            border-radius: 20px;
            font-size: 0.85em;
            margin-right: 8px;
        }
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            background: white;
            border-radius: 8px;
        }
        footer a { color: #3b8dbd; text-decoration: none; font-weight: 600; }
        footer a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>‚öôÔ∏è M√≥dulo Men√∫ de Administraci√≥n</h1>
            <p class="subtitle">Gu√≠a en espa√±ol para el men√∫ de seguridad que convoca las operaciones USER LIST / ADD / UPDATE / DELETE.</p>
            <p><strong>Prop√≥sito:</strong> Garantizar que solo administradores manejen credenciales, roles y operaciones cr√≠ticas con teclas legacy (ENTER / F3 / F7 / F8).</p>
            <p><a href="../../../modules/administration-menu/administration-menu-overview.md" style="color: #f9f9f9; text-decoration: underline; font-weight: 600;">Ver resumen estructurado del m√≥dulo ‚Üí</a></p>
        </header>

        <section class="section">
            <h2>üìã Resumen del M√≥dulo</h2>
            <p><strong>Contexto de negocio:</strong> El Men√∫ de Administraci√≥n reemplaza a `COADM01C` en el mainframe. Controla funciones de seguridad para el staff del back-office a trav√©s de pantallas modernas pero con comportamientos de teclado tradicionales.</p>
            <ul style="line-height: 2;">
                <li>Autenticaci√≥n obligatoria con token y rol `admin` (ver `ProtectedRoute` y `AdminMenuPage`).</li>
                <li>Men√∫ central (`MenuScreen`) con opciones `User List`, `User Add`, `User Update`, `User Delete` y navegaci√≥n con ENTER/F3.</li>
                <li>Operaciones CRUD de usuarios que conservan validaciones estrictas de longitudes (8 caracteres) y mensajes legacy.</li>
                <li>Pantallas que respetan transacciones activas: F3 regresa, F5 guarda, F4 limpia, F12 sale del sistema.</li>
            </ul>
        </section>

        <section class="section">
            <h2>üéØ Gu√≠a de Historias de Usuario</h2>
            <div class="grid">
                <div class="card">
                    <h4>Listado seguro</h4>
                    <p><strong>Patr√≥n:</strong> Como admin, quiero listar usuarios y seleccionar con ENTER las acciones U/D para no abandonar el flujo.</p>
                    <p><strong>Ejemplo:</strong> Como administrador de seguridad, quiero usar la grilla con Select y teclas ENTER/F7/F8 para revisar usuarios y enviar la selecci√≥n `U` sin usar el mouse.</p>
                </div>
                <div class="card">
                    <h4>Alta de usuario</h4>
                    <p><strong>Patr√≥n:</strong> Como admin, quiero ingresar nombre, apellido, ID (8 letras), password (8) y tipo para registrar un nuevo operador.</p>
                    <p><strong>Ejemplo:</strong> Como oficial de seguridad, quiero crear un nuevo usuario `USER1234` con tipo `U` y validar longitud antes de llamar al backend.</p>
                </div>
                <div class="card">
                    <h4>Edici√≥n y baja</h4>
                    <p><strong>Patr√≥n:</strong> Como admin, quiero buscar un `userId`, cargar datos y aplicar cambios o eliminar, todo con pasos guiados (F5 para guardar, F3 para volver).</p>
                    <p><strong>Ejemplo:</strong> Como administrador, quiero editar datos de `USER0001` y, si es necesario, eliminarlo despu√©s de confirmar que no soy el √∫ltimo admin.</p>
                </div>
            </div>

            <h3>‚ö° Factores de aceleraci√≥n</h3>
            <ul style="line-height: 2;">
                <li><strong>`useMenu`:</strong> Encapsula loading, error y navegaci√≥n para men√∫s Main y Admin (reducci√≥n del 40% en l√≥gica repetida).</li>
                <li><strong>`useUserList`:</strong> Controla b√∫squeda paginada (10 filas), entradas legacy (F3/F7/F8) y validaciones U/D antes de navegar.</li>
                <li><strong>`UserApiAdapter`:</strong> Permite alternar entre mocks y backend real sin cambiar componentes.</li>
                <li><strong>`SystemHeader`:</strong> Resalta `transactionId` (CU00, CU01, CU02) para mantener trazabilidad de seguridad.</li>
            </ul>

            <h3>üìä Gu√≠a de complejidades</h3>
            <div>
                <span class="complexity-badge simple">Simple (1-2 pts)</span>
                <span class="complexity-badge medium">Medio (3-5 pts)</span>
                <span class="complexity-badge complex">Complejo (5-8 pts)</span>
            </div>
            <ul style="margin-top: 20px; line-height: 2;">
                <li><strong>Simple:</strong> Agregar validaci√≥n adicional a `UserAddScreen` (ej: regex para apellido) usando `useUserAdd`.</li>
                <li><strong>Medio:</strong> Agregar campo de `department` en listado y propagar a la API (`UserApiAdapter`).</li>
                <li><strong>Complejo:</strong> Sincronizar reglas de negocio de eliminaci√≥n con auditor√≠a externa y reglas COBOL multi-sistema.</li>
            </ul>
        </section>

        <section class="section">
            <h2>üîß Fundaci√≥n t√©cnica</h2>
            <div class="grid">
                <div class="card">
                    <h4>AdminMenuPage</h4>
                    <p><strong>Responsabilidad:</strong> Verifica autenticaci√≥n/admin, carga `getAdminMenuData()` y comparte la UI con `MenuScreen`.</p>
                    <p><strong>Reutilizaci√≥n:</strong> Patr√≥n de guardia para cualquier m√≥dulo cr√≠tico.</p>
                </div>
                <div class="card">
                    <h4>MenuScreen</h4>
                    <p><strong>Responsabilidad:</strong> Renderiza opciones del men√∫ con `MenuCard`, `SystemHeader`, carga y error.</p>
                    <p><strong>Reutilizaci√≥n:</strong> Utilizado por men√∫ principal y administrativo.</p>
                </div>
                <div class="card">
                    <h4>UserListScreen</h4>
                    <p><strong>Responsabilidad:</strong> Tabla con Select para acciones, paginaci√≥n y controles F3/F7/F8.</p>
                    <p><strong>Reutilizaci√≥n:</strong> Template para otros listados seguros.</p>
                </div>
                <div class="card">
                    <h4>UserAddScreen</h4>
                    <p><strong>Responsabilidad:</strong> Formulario con validaciones exactas (8 caracteres, may√∫sculas).</p>
                    <p><strong>Reutilizaci√≥n:</strong> Patr√≥n `handleFieldChange` + `handleSubmit` replicable en otros formularios cr√≠ticos.</p>
                </div>
                <div class="card">
                    <h4>UserUpdateScreen</h4>
                    <p><strong>Responsabilidad:</strong> B√∫squeda por `userId`, modo edici√≥n y ejecuci√≥n de F5/F3/F4.</p>
                    <p><strong>Reutilizaci√≥n:</strong> Plantilla para formularios con b√∫squeda previa.</p>
                </div>
                <div class="card">
                    <h4>Hooks de Usuario</h4>
                    <p><strong>Responsabilidad:</strong> `useUserList`, `useUserAdd`, `useUserUpdate`, `useUserDelete` manejan estado, validaciones y navegaci√≥n.</p>
                    <p><strong>Reutilizaci√≥n:</strong> Modelo para cualquier m√≥dulo con validaciones de tipo legacy.</p>
                </div>
            </div>

            <h3>üîó Dependencias</h3>
            <ul style="line-height: 2;">
                <li><strong>Material-UI:</strong> TextField, Select, Table, Paper, Chip, Button.</li>
                <li><strong>Redux / ProtectedRoute:</strong> Garantiza solo admin con roles `admin` y `back-office`.</li>
                <li><strong>Hooks de API (`useApi`):</strong> Ejecutan fetch/mutation con adaptadores y manejan loading/error.</li>
                <li><strong>Servicios (`UserApiAdapter` y `apiClient`):</strong> Encapsulan endpoints REST reales y modos mock.</li>
            </ul>

            <h3>üåê Interfaces p√∫blicas</h3>
            <pre><code>GET   /api/users/list?pageNumber={n}&direction=FORWARD&startUserId={optional}   ‚Üí Lista paginada de usuarios de seguridad
POST  /api/users/process-selection                                                  ‚Üí Convierte U/D en redirecci√≥n y mensajes
POST  /api/users                                                                    ‚Üí Crea usuario (userId, firstName, lastName, password, userType)
GET   /api/users/{userId}                                                           ‚Üí Obtiene datos para edici√≥n/eliminaci√≥n
PUT   /api/users/{userId}                                                           ‚Üí Actualiza datos (nombre, apellido, contrase√±a, tipo)
DELETE /api/users/{userId}                                                          ‚Üí Elimina un usuario (verifica no eliminar √∫ltimo admin)</code></pre>

            <h3>üìä Modelos de datos</h3>
            <pre><code>export interface UserSecurityData {
  userId: string;
  firstName: string;
  lastName: string;
  userType: 'A' | 'U' | 'R';
  createdDate?: string;
  lastLoginDate?: string;
  isActive?: boolean;
}

export interface UserListRequest {
  searchUserId?: string;
  page: number;
  limit: number;
  startUserId?: string;
  pageNumber?: number;
  direction?: 'FORWARD' | 'BACKWARD';
}

export interface UserSelectionAction {
  action: 'U' | 'D';
  userId: string;
}</code></pre>
        </section>

        <section class="section">
            <h2>üìã Reglas de negocio</h2>
            <div class="card">
                <p><strong>RB-ADM-001:</strong> Solo administradores (`role === 'admin'`) pueden acceder al men√∫ y a `/admin/users/*`.</p>
                <p><strong>RB-ADM-002:</strong> `userId` debe ser may√∫sculas, alfanum√©rico y m√°ximo 8 caracteres.</p>
                <p><strong>RB-ADM-003:</strong> No se permite eliminar el √∫ltimo administrador del sistema (ver mock `userDeleteHandlers`).</p>
                <p><strong>RB-ADM-004:</strong> Las acciones `U` y `D` deben validarse antes de navegar (ver `useUserList.handleUserAction`).</p>
            </div>
        </section>

        <section class="section">
            <h2>üéØ Patrones de criterios de aceptaci√≥n</h2>
            <div class="grid">
                <div class="card">
                    <h4>Autenticaci√≥n</h4>
                    <p>Dado que soy un usuario autenticado con rol `admin`<br>
                    Cuando accedo a `/menu/admin`<br>
                    Entonces veo solo las opciones administrativas y no puedo entrar si soy `back-office`.</p>
                </div>
                <div class="card">
                    <h4>Validaci√≥n</h4>
                    <p>Dado que ingreso un `userId` de m√°s de 8 caracteres<br>
                    Cuando env√≠o el formulario de alta<br>
                    Entonces la pantalla muestra el error `User ID must be 8 characters or less`.</p>
                </div>
                <div class="card">
                    <h4>Rendimiento</h4>
                    <p>Dado que consulto la lista de usuarios<br>
                    Cuando el backend responde<br>
                    Entonces la tabla se actualiza en menos de 600 ms (P95) incluyendo paginaci√≥n.</p>
                </div>
                <div class="card">
                    <h4>Manejo de errores</h4>
                    <p>Dado que selecciono `D` para eliminar<br>
                    Cuando el backend responde `Cannot delete administrator users`<br>
                    Entonces `UserDeleteScreen` muestra esa alerta sin salir de la pantalla.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>‚ö° Consideraciones de rendimiento</h2>
            <ul style="line-height: 2;">
                <li><strong>Lista:</strong> 600ms P95 para renderizar hasta 10 usuarios con validaciones `handleEnterKey`.</li>
                <li><strong>Alta/Edici√≥n:</strong> 1s P95 para enviar formularios (`useMutation` con `useUserAdd`).</li>
                <li><strong>Paginaci√≥n:</strong> Operaciones F7/F8 utilizan cach√© local y no recargan estado global completo.</li>
                <li><strong>Celdas:</strong> La tabla no renderiza m√°s de 10 rows para mantener consistencia con legacy.</li>
            </ul>
        </section>

        <section class="section">
            <h2>üö® Riesgos y mitigaciones</h2>
            <div class="grid">
                <div class="card">
                    <h4>‚ö†Ô∏è Eliminaci√≥n del √∫ltimo admin</h4>
                    <p><strong>Riesgo:</strong> Borrar todos los admins bloquea el sistema.<br>
                    <strong>Mitigaci√≥n:</strong> El mock `userDeleteHandlers` y la API real validan que quede al menos un admin antes de eliminar.</p>
                </div>
                <div class="card">
                    <h4>‚ö†Ô∏è Dependencia de `role` en frontend</h4>
                    <p><strong>Riesgo:</strong> Cambios en el slice `auth` pueden desincronizar `ProtectedRoute`.<br>
                    <strong>Mitigaci√≥n:</strong> Los componentes revisan `selectCurrentUser` y redirigen a `/menu/main` si no es admin.</p>
                </div>
                <div class="card">
                    <h4>‚ö†Ô∏è Validaciones duplicadas</h4>
                    <p><strong>Riesgo:</strong> Backend/Frontend con reglas distintas (`password`, `userId`).<br>
                    <strong>Mitigaci√≥n:</strong> `useUserAdd` y `useUserUpdate` replican los mensajes legados y se documentan en esta gu√≠a.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>üìö Ejemplos de c√≥digo</h2>
            <h3>Hook `useUserList` (resumen)</h3>
            <pre><code>const handleUserAction = useCallback((action) => {
  if (!['U', 'D'].includes(action.action)) {
    options.onError?.('Invalid selection...');
    return;
  }
  navigate(`/admin/users/${action.action === 'U' ? 'update' : 'delete'}?userId=${action.userId}`);
}, [navigate, options]);</code></pre>

            <h3>Hook `useUserAdd` (validaciones)</h3>
            <pre><code>const validateForm = useCallback(() => {
  const errors: UserAddValidationErrors = {};
  if (!formData.userId.trim()) errors.userId = 'User ID can NOT be empty...';
  if (formData.userId.length > 8) errors.userId = 'User ID must be 8 characters or less';
  if (!['A', 'U'].includes(formData.userType)) errors.userType = 'User Type must be A (Admin) or U (User)';
  setValidationErrors(errors);
  return Object.keys(errors).length === 0;
}, [formData]);</code></pre>
        </section>

        <section class="section">
            <h2>üìä Tabla de validaciones</h2>
            <table>
                <thead>
                    <tr>
                        <th>Campo</th>
                        <th>Validaci√≥n</th>
                        <th>Mensaje</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>userId</td><td>Alfanum√©rico, may√∫sculas, ‚â§ 8</td><td>`User ID can NOT be empty...` / `must be 8 characters or less`</td></tr>
                    <tr><td>Password</td><td>Requerido, ‚â§ 8 caracteres</td><td>`Password can NOT be empty...`</td></tr>
                    <tr><td>User Type</td><td>Debe ser `A` o `U`</td><td>`User Type must be A (Admin) or U (User)`</td></tr>
                    <tr><td>Selecci√≥n</td><td>Solo `U` o `D`</td><td>`Invalid selection. Valid values are U and D`</td></tr>
                    <tr><td>Teclas</td><td>ENTER = acci√≥n, F3 = salir, F7/F8 = paginaci√≥n</td><td>Mensajes contextuales en la UI</td></tr>
                </tbody>
            </table>
        </section>

        <footer>
            <p><a href="../../index.html">‚Üê Volver al √çndice de M√≥dulos</a></p>
            <p><a href="../../../system-overview.md">üè† Volver al System Overview</a></p>
            <p style="color: #666; margin-top: 15px;"><em>√öltima actualizaci√≥n: 2026-02-15 | Precisi√≥n por m√≥dulo: 97%</em></p>
        </footer>
    </div>
</body>
</html>
