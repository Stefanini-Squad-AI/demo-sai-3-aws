import{u as q,j as e,a as X,B as f,P as _,f as E,b as A,a1 as ee,h as i,I as P,g as te,d as k,z as se,A as U,t as D,a2 as ae,a3 as re,a4 as ne,J as d,O,Q as W,y as ie,D as M,S as R,a5 as Y,i as le,a6 as $,R as oe,K as de,x as ce,a7 as ue,a8 as me,a9 as xe,aa as pe,ab as he}from"./mui-erjdo8JM.js";import{r as n}from"./vendor-BPyidg2q.js";import{S as ge}from"./SystemHeader-CEfbHT8G.js";import{L as be,g as B}from"./index-CIcxBNqj.js";import{u as K}from"./useApi-DlruXcAB.js";import{u as je}from"./router-Cq5RlOku.js";import"./redux-B6kvt0Aa.js";function fe({onSearch:x,onUpdate:h,onExit:C,accountData:s,hasChanges:u=!1,loading:p=!1,error:I,onDataChange:b,onReset:v}){const g=q(),[j,y]=n.useState(""),[w,L]=n.useState(null),[z,r]=n.useState(!1),[a,S]=n.useState(!1),[m,T]=n.useState({}),J=n.useCallback(t=>{const c=t.target.value;y(c),L(null)},[]),G=n.useCallback(t=>{if(t.preventDefault(),!j.trim()){L("Account number not provided");return}x({accountId:j}),S(!1)},[j,x]),l=n.useCallback((t,c)=>{if(!b||!s)return;const o={...m};switch(t){case"creditLimit":case"cashCreditLimit":case"currentBalance":c&&isNaN(Number(c))?o[t]="Must be a valid number":delete o[t];break;case"activeStatus":c&&!["Y","N"].includes(c)?o[t]="Must be Y or N":delete o[t];break;case"zipCode":c&&!/^\d{5}(-\d{4})?$/.test(c)?o[t]="Invalid ZIP code format":delete o[t];break}T(o),b({[t]:c})},[b,s,m]),N=n.useCallback(()=>{!s||Object.keys(m).length>0||r(!0)},[s,m]),H=n.useCallback(()=>{s&&(h(s),r(!1),S(!1))},[s,h]),F=n.useCallback(()=>{v?.(),T({}),S(!1)},[v]),Z=n.useCallback(t=>{t.key==="F3"||t.key==="Escape"?(t.preventDefault(),C?.()):t.key==="F5"&&s&&u?(t.preventDefault(),N()):t.key==="F12"&&(t.preventDefault(),F())},[C,s,u,N,F]);n.useCallback(t=>t==null?"":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(t),[]),n.useCallback(t=>{if(!t)return"";try{return new Date(t).toLocaleDateString("en-US")}catch{return t}},[]);const Q=t=>{switch(t){case"Y":return"success";case"N":return"error";default:return"default"}},V=t=>{switch(t){case"Y":return"Active";case"N":return"Inactive";default:return"Unknown"}};return e.jsx(X,{maxWidth:"xl",sx:{py:3},children:e.jsxs(f,{onKeyDown:Z,tabIndex:-1,children:[e.jsx(ge,{transactionId:"CAUP",programName:"COACTUPC",title:"CardDemo - Account Update",subtitle:"Update Account Information"}),e.jsxs(_,{elevation:2,sx:{borderRadius:3,overflow:"hidden",background:`linear-gradient(145deg, ${E(g.palette.background.paper,.9)}, ${E(g.palette.background.default,.1)})`},children:[e.jsx(f,{sx:{p:3,textAlign:"center",background:`linear-gradient(135deg, ${g.palette.primary.main}, ${g.palette.secondary.main})`,color:"white"},children:e.jsxs(A,{variant:"h5",fontWeight:600,children:[e.jsx(ee,{sx:{mr:1,verticalAlign:"middle"}}),"Update Account"]})}),e.jsxs(f,{sx:{p:3},children:[e.jsxs(f,{component:"form",onSubmit:G,sx:{display:"flex",alignItems:"center",gap:2,justifyContent:"center",flexWrap:"wrap",mb:3},children:[e.jsx(A,{variant:"body1",color:"primary.main",fontWeight:600,children:"Account Number:"}),e.jsx(i,{value:j,onChange:J,placeholder:"11111111111",size:"medium",disabled:p,error:!!w,helperText:w,inputProps:{maxLength:11,style:{textAlign:"center",fontSize:"1.1rem",fontWeight:600}},InputProps:{startAdornment:e.jsx(P,{position:"start",children:e.jsx(te,{color:"primary"})})},sx:{width:200}}),e.jsx(k,{type:"submit",variant:"contained",disabled:p,startIcon:p?e.jsx(be,{size:20}):e.jsx(se,{}),sx:{borderRadius:2,px:3,fontWeight:600},children:p?"Searching...":"Search"})]}),I&&e.jsx(U,{severity:"error",sx:{mb:3,borderRadius:2},children:I}),s&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(f,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(D,{label:V(s.activeStatus),color:Q(s.activeStatus),variant:"filled",sx:{fontWeight:600}}),u&&e.jsx(D,{label:"Unsaved Changes",color:"warning",variant:"outlined",icon:e.jsx(ae,{}),sx:{fontWeight:600}})]}),e.jsx(re,{control:e.jsx(ne,{checked:a,onChange:t=>S(t.target.checked),color:"primary"}),label:"Edit Mode"})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,lg:6,children:e.jsx(O,{elevation:1,children:e.jsxs(W,{children:[e.jsxs(A,{variant:"h6",gutterBottom:!0,color:"primary.main",children:[e.jsx(ie,{sx:{mr:1,verticalAlign:"middle"}}),"Account Information"]}),e.jsx(M,{sx:{mb:2}}),e.jsxs(R,{spacing:2,children:[e.jsxs(i,{label:"Account Status",select:!0,value:s.activeStatus||"",onChange:t=>l("activeStatus",t.target.value),disabled:!a,error:!!m.activeStatus,helperText:m.activeStatus,size:"small",fullWidth:!0,children:[e.jsx(Y,{value:"Y",children:"Y - Active"}),e.jsx(Y,{value:"N",children:"N - Inactive"})]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:4,children:e.jsx(i,{label:"Open Year",value:s.openDate?new Date(s.openDate).getFullYear():"",onChange:t=>{const c=t.target.value;if(s.openDate){const o=new Date(s.openDate);o.setFullYear(parseInt(c)||o.getFullYear()),l("openDate",o.toISOString().split("T")[0])}},disabled:!a,size:"small",type:"number"})}),e.jsx(d,{item:!0,xs:4,children:e.jsx(i,{label:"Open Month",value:s.openDate?new Date(s.openDate).getMonth()+1:"",onChange:t=>{const c=parseInt(t.target.value)-1;if(s.openDate){const o=new Date(s.openDate);o.setMonth(c),l("openDate",o.toISOString().split("T")[0])}},disabled:!a,size:"small",type:"number",inputProps:{min:1,max:12}})}),e.jsx(d,{item:!0,xs:4,children:e.jsx(i,{label:"Open Day",value:s.openDate?new Date(s.openDate).getDate():"",onChange:t=>{const c=parseInt(t.target.value);if(s.openDate){const o=new Date(s.openDate);o.setDate(c),l("openDate",o.toISOString().split("T")[0])}},disabled:!a,size:"small",type:"number",inputProps:{min:1,max:31}})})]}),e.jsx(i,{label:"Credit Limit",value:s.creditLimit||"",onChange:t=>l("creditLimit",parseFloat(t.target.value)||0),disabled:!a,error:!!m.creditLimit,helperText:m.creditLimit,size:"small",type:"number",InputProps:{startAdornment:e.jsx(P,{position:"start",children:"$"})}}),e.jsx(i,{label:"Cash Credit Limit",value:s.cashCreditLimit||"",onChange:t=>l("cashCreditLimit",parseFloat(t.target.value)||0),disabled:!a,error:!!m.cashCreditLimit,helperText:m.cashCreditLimit,size:"small",type:"number",InputProps:{startAdornment:e.jsx(P,{position:"start",children:"$"})}}),e.jsx(i,{label:"Account Group",value:s.groupId||"",onChange:t=>l("groupId",t.target.value),disabled:!a,size:"small"})]})]})})}),e.jsx(d,{item:!0,xs:12,lg:6,children:e.jsx(O,{elevation:1,children:e.jsxs(W,{children:[e.jsxs(A,{variant:"h6",gutterBottom:!0,color:"primary.main",children:[e.jsx(le,{sx:{mr:1,verticalAlign:"middle"}}),"Customer Information"]}),e.jsx(M,{sx:{mb:2}}),e.jsxs(R,{spacing:2,children:[e.jsx(i,{label:"Customer ID",value:s.customerId||"",disabled:!0,size:"small"}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:4,children:e.jsx(i,{label:"First Name",value:s.firstName||"",onChange:t=>l("firstName",t.target.value),disabled:!a,size:"small"})}),e.jsx(d,{item:!0,xs:4,children:e.jsx(i,{label:"Middle Name",value:s.middleName||"",onChange:t=>l("middleName",t.target.value),disabled:!a,size:"small"})}),e.jsx(d,{item:!0,xs:4,children:e.jsx(i,{label:"Last Name",value:s.lastName||"",onChange:t=>l("lastName",t.target.value),disabled:!a,size:"small"})})]}),e.jsx(i,{label:"Address Line 1",value:s.addressLine1||"",onChange:t=>l("addressLine1",t.target.value),disabled:!a,size:"small"}),e.jsx(i,{label:"Address Line 2",value:s.addressLine2||"",onChange:t=>l("addressLine2",t.target.value),disabled:!a,size:"small"}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:6,children:e.jsx(i,{label:"State",value:s.stateCode||"",onChange:t=>l("stateCode",t.target.value),disabled:!a,size:"small",inputProps:{maxLength:2}})}),e.jsx(d,{item:!0,xs:6,children:e.jsx(i,{label:"ZIP Code",value:s.zipCode||"",onChange:t=>l("zipCode",t.target.value),disabled:!a,error:!!m.zipCode,helperText:m.zipCode,size:"small"})})]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:6,children:e.jsx(i,{label:"Phone 1",value:s.phoneNumber1||"",onChange:t=>l("phoneNumber1",t.target.value),disabled:!a,size:"small"})}),e.jsx(d,{item:!0,xs:6,children:e.jsx(i,{label:"Phone 2",value:s.phoneNumber2||"",onChange:t=>l("phoneNumber2",t.target.value),disabled:!a,size:"small"})})]}),e.jsx(i,{label:"FICO Score",value:s.ficoScore||"",onChange:t=>l("ficoScore",parseInt(t.target.value)||0),disabled:!a,size:"small",type:"number",inputProps:{min:300,max:850}})]})]})})})]}),a&&e.jsxs(f,{sx:{mt:3,display:"flex",gap:2,justifyContent:"center"},children:[e.jsx(k,{variant:"contained",color:"primary",startIcon:e.jsx($,{}),onClick:N,disabled:!u||Object.keys(m).length>0,sx:{borderRadius:2,px:3},children:"Save Changes"}),e.jsx(k,{variant:"outlined",startIcon:e.jsx(oe,{}),onClick:F,disabled:!u,sx:{borderRadius:2,px:3},children:"Reset"})]})]})]}),e.jsx(f,{sx:{p:2,bgcolor:E(g.palette.grey[100],.5),borderTop:`1px solid ${g.palette.divider}`},children:e.jsxs(R,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:1,children:[e.jsxs(A,{variant:"body2",color:"text.secondary",children:[e.jsx(de,{sx:{fontSize:16,mr:.5,verticalAlign:"middle"}}),"ENTER = Search • F5 = Save • F12 = Cancel"]}),e.jsx(k,{variant:"outlined",size:"small",startIcon:e.jsx(ce,{}),onClick:C,disabled:p,sx:{borderRadius:2},children:"F3 = Exit"})]})})]}),e.jsxs(ue,{open:z,onClose:()=>r(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(me,{children:[e.jsx(xe,{color:"success",sx:{mr:1,verticalAlign:"middle"}}),"Confirm Update"]}),e.jsxs(pe,{children:[e.jsxs(A,{children:["Are you sure you want to save the changes to account ",s?.accountId,"?"]}),u&&e.jsx(U,{severity:"info",sx:{mt:2},children:"This will update both account and customer information in the database."})]}),e.jsxs(he,{children:[e.jsx(k,{onClick:()=>r(!1),children:"Cancel"}),e.jsx(k,{onClick:H,variant:"contained",startIcon:e.jsx($,{}),children:"Confirm Save"})]})]})]})})}function Ce(){const[x,h]=n.useState(null),[C,s]=n.useState(!1),[u,p]=n.useState(null),{mutate:I,loading:b,error:v}=K(async r=>{const a=parseInt(r.accountId,10);return await B.get(`/accounts/${a}`)},{onSuccess:r=>{h(r),p(r),s(!1)},onError:r=>{console.error("Error searching account:",r),h(null),p(null)}}),{mutate:g,loading:j,error:y}=K(async r=>await B.put(`/accounts/${r.accountId}`,r),{onSuccess:r=>{r.success&&r.data&&(h(r.data),p(r.data),s(!1))},onError:r=>{console.error("Error updating account:",r)}}),w=n.useCallback(r=>{if(!x)return;const a={...x,...r};h(a);const S=u?JSON.stringify(a)!==JSON.stringify(u):!1;s(S)},[x,u]),L=n.useCallback(()=>{u&&(h(u),s(!1))},[u]),z=n.useCallback(()=>{h(null),p(null),s(!1)},[]);return{accountData:x,hasChanges:C,searchAccount:I,updateAccount:g,updateLocalData:w,resetForm:L,clearData:z,searchLoading:b,updateLoading:j,searchError:v,updateError:y,loading:b||j,error:v||y}}function Le(){const x=je(),{accountData:h,hasChanges:C,searchAccount:s,updateAccount:u,updateLocalData:p,resetForm:I,clearData:b,loading:v,error:g}=Ce();n.useEffect(()=>{if(!localStorage.getItem("userRole")){x("/login");return}b()},[x,b]);const j=()=>{const y=localStorage.getItem("userRole");x(y==="admin"?"/menu/admin":"/menu/main")};return e.jsx(fe,{onSearch:s,onUpdate:u,onExit:j,accountData:h,hasChanges:C,loading:v,error:g,onDataChange:p,onReset:I})}export{Le as default};
